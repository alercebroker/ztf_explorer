name: S3DeployDev

on:
  push:
    branches: [ develop ]

env:
  AWS_BUCKET_NAME: ${{ secrets.AWS_BUCKET_NAME_DEV }}
  AWS_CLOUDFRONT: ${{ secrets.AWS_CLOUDFRONT_ID_DEV }}
  NODE_ENV: staging
  APP_TITLE: ALeRCE Explorer - Staging Build

jobs:
  publish:
    runs-on: ubuntu-latest
    environment: development
    env:
      GOOGLE_REDIRECT_URI: ${{ secrets.GOOGLE_REDIRECT_URI }}
      AVRO_API_BASE_URL: ${{ secrets.AVRO_API_BASE_URL }}
      CATSHTM_API_BASE_URL: ${{ secrets.CATSHTM_API_BASE_URL }}
      TNS_API_BASE_URL: ${{ secrets.TNS_API_BASE_URL }}
      ZTF_API_BASE_URL: ${{ secrets.ZTF_API_BASE_URL }}
      ZTF_DR_API_BASE_URL: ${{ secrets.ZTF_DR_API_BASE_URL }}
      USERS_API_BASE_URL: ${{ secrets.USERS_API_BASE_URL }}
    steps:
      - name: Configure AWS credentials
        id: creds
        uses: aws-actions/configure-aws-credentials@v4
        with:
          role-to-assume: ${{ secrets.AWS_ROLE_STAGING }}
          aws-region: us-east-1
          output-credentials: true
          unset-current-credentials: true
      - uses: actions/checkout@v1
      - uses: actions/setup-node@v1
        with:
          node-version: 16
      - run: npm install
      - run: npm run generate
      - run: npm run deploy
